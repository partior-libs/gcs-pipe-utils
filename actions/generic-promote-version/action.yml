name: 'Partior - Promote Artifact Version in Artifactory'
description: 'Promote Artifact Version in Artifactory'
inputs:
  jfrog-token:  
    description: 'JFrog Token'
    required: true
    default: ''

  yaml-branch-config-importer-file:  
    description: 'Path to the yaml importer file generated by yaml-importer action'
    required: true
    default: ''

  promote-from-env:
    description: 'Environment name of which the artifact will be promoted'
    required: true
    default: ''

  promotion-env-name:
    description: 'Name in Environment setting to invoke approval flow'
    required: false
    default: 'PROMOTION-FLOW'

outputs:
  generated-filename:
    description: "Filename of the modified config file"
    value: ${{ inputs.target-conf-file }}
runs:
  using: "composite"
  steps:
    - name: Setup jfrog
      if: steps.pipeline-branch-config.outputs.artifact_packager_enabled == 'true'
      uses: jfrog/setup-jfrog-cli@v2
      env:
        JF_ENV_1: ${{ inputs.jfrog-token }}

    - name: override props config file
      run: ${{ github.action_path }}/../../scripts/generic-override-prop-conf.sh "${{ inputs.base-conf-file }}" "${{ inputs.target-conf-file }}"
      shell: bash

    - name: upload properties config
      uses: actions/upload-artifact@v3
      if: inputs.upload == 'true'
      with:
        name: ${{ inputs.target-conf-file }}
        path: ${{ inputs.target-conf-file }}
        if-no-files-found: error
        retention-days: 1
        
    - run: echo Done promoting...
      shell: bash
